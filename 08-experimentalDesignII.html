<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lieven Clement" />


<title>8.3 Experimental Design II: Replication and Power</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>


<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01-intro.html">1. Introduction</a>
    </li>
    <li>
      <a href="02-concepts.html">2. Concepts</a>
    </li>
    <li>
      <a href="03-experimentalDesign.html">3. Experimental Design I</a>
    </li>
    <li>
      <a href="04-dataExploration.html">4. Data Exploration</a>
    </li>
    <li>
      <a href="05-statisticalInference.html">5.1 Statistical Inference 1</a>
    </li>
    <li>
      <a href="05-statisticalInference-twosampleT.html">5.2 Statistical Inference 2</a>
    </li>
    <li>
      <a href="06-linearRegression.html">6. Linear Regression</a>
    </li>
    <li>
      <a href="07-Anova.html">7. Analysis of Variance</a>
    </li>
    <li>
      <a href="08-MultipleRegression.html">8. Multiple Regression</a>
    </li>
    <li>
      <a href="08-MultipleRegression-SpecificDesigns.html">8.2 Multiple Regression: Factorial Designs</a>
    </li>
    <li>
      <a href="08-experimentalDesignII.html">8.3. Experimental Design II</a>
    </li>
    <li>
      <a href="08-experimentalDesignIII.html">8.4. Experimental Design III</a>
    </li>
    <li>
      <a href="09-NonparametericStatistics-WilcoxonMannWithney.html">9.1. Nonparametric Statistics 1</a>
    </li>
    <li>
      <a href="09-NonparametericStatistics-KruskalWallis.html">9.2. Nonparametric Statistics 2</a>
    </li>
    <li>
      <a href="10-categoricalDataAnalysis.html">10. Categorical Data Analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="04_exercises.html">4. Data Exploration</a>
    </li>
    <li>
      <a href="05_exercises.html">5. Statistical inference</a>
    </li>
    <li>
      <a href="06_exercises.html">6. Simple linear regression</a>
    </li>
    <li>
      <a href="07_exercises.html">7. ANOVA</a>
    </li>
    <li>
      <a href="08_exercises.html">8. Multiple linear regression</a>
    </li>
    <li>
      <a href="09_exercises.html">9. Non-parametric statistics</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statOmics/PSLS">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://statomics.github.io/">statOmics</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">8.3 Experimental Design II: Replication and Power</h1>
<h4 class="author">Lieven Clement</h4>
<h4 class="date">statOmics, Ghent University (<a href="https://statomics.github.io" class="uri">https://statomics.github.io</a>)</h4>

</div>


<p><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ───────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.3.5     ✔ purrr   0.3.4
## ✔ tibble  3.1.6     ✔ dplyr   1.0.8
## ✔ tidyr   1.2.0     ✔ stringr 1.4.0
## ✔ readr   2.1.2     ✔ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ──────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div id="concepts" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Concepts</h1>
<ul>
<li>Experimental units representative for population: Randomisation</li>
<li>Replication: technical vs biological, sample size - power</li>
<li>Sources of variation: technical, biological, within subject, between subject</li>
</ul>
</div>
<div id="replication" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Replication</h1>
<p>Two pager on Replication in nature methods: [<a href="https://www.nature.com/articles/nmeth.3091.pdf">PDF</a>] <embed src="https://www.nature.com/articles/nmeth.3091.pdf" style="width:100.0%" /></p>
<div id="example" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Example</h2>
<p>Consider a single cell RNA-seq experiment where researchers want to assess the effect of drug treatment on gene expression</p>
<p>Potential research questions</p>
<ul>
<li>Is there a difference in average gene expression between treated and non treated samples</li>
<li>Is there a difference in variability of gene expression between treated and non treated samples</li>
</ul>
</div>
<div id="sources-of-variation" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Sources of variation</h2>
<p>TABLE 1 NATURE METHODS | VOL.11 NO.9 | SEPTEMBER 2014 | 879 - 880</p>
<table>
<colgroup>
<col width="35%" />
<col width="28%" />
<col width="35%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"></th>
<th align="left">Replicate type</th>
<th align="center">Replicate category<span class="math inline">\(^\text{a}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"></td>
<td align="left">Colonies</td>
<td align="center">B</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left">Strains</td>
<td align="center">B</td>
</tr>
<tr class="odd">
<td align="center">Animal study subjects</td>
<td align="left">Cohoused groups</td>
<td align="center">B</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left">Gender</td>
<td align="center">B</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="left">Individuals</td>
<td align="center">B</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="left">Organs from sacrificed animals</td>
<td align="center">B</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left">Methods for dissociating cells from tissue</td>
<td align="center">T</td>
</tr>
<tr class="odd">
<td align="center">Sample preparation</td>
<td align="left">Dissociation runs from given tissue sample</td>
<td align="center">T</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left">Individual cells</td>
<td align="center">B</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="left"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left">RNA-seq library construction</td>
<td align="center">T</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="left">Runs from the library of a given cell</td>
<td align="center">T</td>
</tr>
<tr class="even">
<td align="center">Sequencing</td>
<td align="left">Reads from different transcript molecules</td>
<td align="center">V<span class="math inline">\(^\text{b}\)</span></td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="left">Reads with unique molecular identifier (UMI) from a given transcript molecule</td>
<td align="center">T</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: lower-alpha">
<li>Replicates are categorized as biological (B), technical (T) or of variable type (V).</li>
<li>Sequence reads serve diverse purposes depending on the application and how reads are used in analysis.</li>
</ol>
<hr />
</div>
<div id="at-which-level-should-we-replicate" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> At which level should we replicate?</h2>
<ul>
<li><span class="math inline">\(\text{var}(X)=\sigma^2_A+\sigma^2_C+\sigma^2_M=\sigma^2_{TOT}\)</span></li>
<li><span class="math inline">\(\text{var}(\bar{X})=\frac{\sigma^2_A}{n_A}+\frac{\sigma^2_C}{n_A n_C} + \frac{\sigma^2_M}{n_A n_C n_M}\)</span></li>
</ul>
<p><img src="https://media.springernature.com/full/springer-static/image/art%3A10.1038%2Fnmeth.3091/MediaObjects/41592_2014_Article_BFnmeth3091_Fig1_HTML.jpg" /> Figure 1 NATURE METHODS | VOL.11 NO.9 | SEPTEMBER 2014 | 879 - 880</p>
<ol style="list-style-type: lower-alpha">
<li>Three levels of replication (two biological, one technical) with animal, cell and measurement replicates normally distributed with a mean across animals of 10 and ratio of variances 1:2:0.5. Solid green (biological) and blue (technical) dots show how a measurement of the expression (X = 12) samples from all three sources of variation. Distribution s.d. is shown as horizontal lines.</li>
<li>Expression variance, Var(X), and variance of expression mean, Var(<span class="math inline">\(\bar X\)</span>), computed across 10,000 simulations of nAnCnM = 48 measurements for unique combinations of the number of animals (nA = 1 to 48), cells per animal (nC = 1 to 48) and technical replicate measurements per cell (nM = 1 and 3). The ratio of Var(X) and Var(<span class="math inline">\(\bar X\)</span>) is the effective sample size, n, which corresponds to the equivalent number of statistically independent measurements. Horizontal dashed lines correspond to biological and total variation. Error bars on Var(X) show s.d. from the 10,000 simulated samples (nM = 1).</li>
</ol>
<hr />
<ul>
<li>Cost benefit trade-off: cost difference between biological and technical replicates</li>
<li>Typically, biological variability is substantially larger than technical variability</li>
</ul>
<p><span class="math inline">\(\rightarrow\)</span> commit resources to sampling biologically relevant variables</p>
<p><span class="math inline">\(\rightarrow\)</span> unless measures of technical variability are of interest then increasing number of technical measurements is valuable.</p>
<ul>
<li><p>Good experimental design practice includes planning for replication.</p>
<ol style="list-style-type: decimal">
<li>Identify the research questions to be answered with experiments.</li>
<li>Determine proportion of variability induced by each step.</li>
<li>Be aware for pseudoreplication and aim for statistically independent replicates.</li>
</ol></li>
</ul>
<hr />
</div>
</div>
<div id="power-sample-size-and-other-design-aspects" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Power, sample size and other design aspects</h1>
<p>Reading materials: <a href="https://www.nature.com/articles/nmeth.2738.pdf">Nature Methods (2013), 10(12), 1139–1140</a></p>
<div id="intermezzo-linear-regression-in-matrix-form" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Intermezzo linear regression in matrix form</h2>
<ul>
<li>Linear regression is a very important statistical tool to study the association between variables and to build prediction models.</li>
</ul>
<div id="scalar-form" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Scalar form</h3>
<ul>
<li>Consider a vector of predictors <span class="math inline">\(\mathbf{x}=(x_1,\ldots,x_p)\)</span> and</li>
<li>a real-valued response <span class="math inline">\(Y\)</span></li>
<li>then the linear regression model can be written as <span class="math display">\[
Y=f(\mathbf{x}) +\epsilon=\beta_0+\sum\limits_{j=1}^p x_j\beta_j + \epsilon
\]</span> with i.i.d. <span class="math inline">\(\epsilon\sim N(0,\sigma^2)\)</span></li>
</ul>
</div>
<div id="vectormatrix-form" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Vector/Matrix form</h3>
<ul>
<li><span class="math inline">\(n\)</span> observations <span class="math inline">\((\mathbf{x}_1,y_1) \ldots (\mathbf{x}_n,y_n)\)</span> with <span class="math inline">\(\mathbf{x}_1^T=[1 x_1 \ldots x_p]\)</span></li>
<li>Regression in matrix notation <span class="math display">\[\mathbf{Y}=\mathbf{X\beta} + \mathbf{\epsilon}\]</span> with <span class="math inline">\(\mathbf{Y}=\left[\begin{array}{c}y_1\\ \vdots\\y_n\end{array}\right]\)</span>, <span class="math inline">\(\mathbf{X}=\left[\begin{array}{cccc} 1&amp;x_{11}&amp;\ldots&amp;x_{1p}\\ \vdots&amp;\vdots&amp;&amp;\vdots\\ 1&amp;x_{n1}&amp;\ldots&amp;x_{np} \end{array}\right]\)</span> or <span class="math inline">\(\mathbf{X}=\left[\begin{array}{c} \mathbf{x}_1^T\\\vdots\\\mathbf{x}_n^T\end{array}\right]\)</span>, <span class="math inline">\(\boldsymbol{\beta}=\left[\begin{array}{c}\beta_0\\ \vdots\\ \beta_p\end{array}\right]\)</span> and <span class="math inline">\(\mathbf{\epsilon}=\left[\begin{array}{c} \epsilon_1 \\ \vdots \\ \epsilon_n\end{array}\right]\)</span></li>
</ul>
<hr />
</div>
</div>
<div id="least-squares-ls" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Least Squares (LS)</h2>
<ul>
<li><p>Minimize the residual sum of squares <span class="math display">\[\begin{eqnarray*}
RSS(\boldsymbol{\beta})&amp;=&amp;\sum\limits_{i=1}^n e^2_i\\
&amp;=&amp;\sum\limits_{i=1}^n \left(y_i-\beta_0-\sum\limits_{j=1}^p x_{ij}\beta_j\right)^2
\end{eqnarray*}\]</span></p></li>
<li><p>or in matrix notation</p></li>
</ul>
<p><span class="math display">\[
\text{RSS}(\boldsymbol{\beta})=(\mathbf{Y}-\mathbf{X\beta})^T(\mathbf{Y}-\mathbf{X\beta})
\]</span></p>
<p><span class="math display">\[\rightarrow \hat{\boldsymbol{\beta}}=\text{argmin}_\beta \text{ RSS}(\boldsymbol{\beta})\]</span></p>
<hr />
<div id="minimize-rss" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Minimize RSS</h3>
<p><span class="math display">\[
\begin{array}{ccc}
\frac{\partial RSS}{\partial \boldsymbol{\beta}}&amp;=&amp;\mathbf{0}\\\\
\frac{(\mathbf{Y}-\mathbf{X\beta})^T(\mathbf{Y}-\mathbf{X}\boldsymbol{\beta})}{\partial \boldsymbol{\beta}}&amp;=&amp;\mathbf{0}\\\\
-2\mathbf{X}^T(\mathbf{Y}-\mathbf{X}\boldsymbol{\beta})&amp;=&amp;\mathbf{0}\\\\
\mathbf{X}^T\mathbf{X\beta}&amp;=&amp;\mathbf{X}^T\mathbf{Y}\\\\
\hat{\boldsymbol{\beta}}&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}
\end{array}
\]</span></p>
<hr />
</div>
</div>
<div id="variance-estimator" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Variance Estimator?</h2>
<p><span class="math display">\[
\begin{array}{ccl}
\hat{\boldsymbol{\Sigma}}_{\hat{\boldsymbol{\beta}}}
&amp;=&amp;\text{var}\left[(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}\right]\\\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\text{var}\left[\mathbf{Y}\right]\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\\\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T(\mathbf{I}\sigma^2)\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}
\\\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{I}\quad\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\sigma^2\\\\
%\hat{\boldmath{\Sigma}}_{\hat{\boldsymbol{\beta}}}&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T \text{var}\left[\mathbf{Y}\right](\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\sigma^2\\\\
&amp;=&amp;(\mathbf{X}^T\mathbf{X})^{-1}\sigma^2
\end{array}
\]</span></p>
<p>The uncertainty on the model parameters thus depends on the residual variability and the design!</p>
<ul>
<li>The larger <span class="math inline">\(\mathbf{X}^T\mathbf{X}\)</span> the more information the experiment contains on the model parameters and the smaller their variances and standard errors will be!</li>
<li>Factorial designs?</li>
<li>Designs with continuous predictors?</li>
</ul>
<hr />
<p>The effect size of interest is typically a linear combinations of the model parameters, i.e. <span class="math display">\[
l_0 \times \beta_0 + l_1 \times \beta_1 + ... + l_{p-1} \times \beta_{p-1} = \mathbf{L}^T\boldsymbol{\beta}
\]</span></p>
<p>The null hypothesis of our test statistics is than formulated as</p>
<p><span class="math display">\[
H_0: \mathbf{L}^T\boldsymbol{\beta} = 0
\]</span></p>
<p>vs the alternative hypothesis</p>
<p><span class="math display">\[
H_0: \mathbf{L}^T\boldsymbol{\beta} \neq 0
\]</span> which can be assessed using a t-test statistic:</p>
<p><span class="math display">\[
t=\frac{\mathbf{L}^T\hat{\boldsymbol{\beta}} - 0}{\text{se}_{\mathbf{L}^T\hat{\boldsymbol{\beta}}}}
\]</span> which follows a t-distribution with n-p degrees of freedom under the null hypothesis when all assumptions for the linear model are valid.</p>
<p>So the power</p>
<p><span class="math display">\[P(p &lt; 0.05 | H_1)\]</span></p>
<p>will typically depends on</p>
<ul>
<li>the real effect size in the population <span class="math inline">\(\mathbf{L}^T\boldsymbol{\beta}\)</span>.</li>
<li>Number of observations: SE and df of t-test.</li>
<li>Choice of the design points.</li>
<li>Choice of significance level.</li>
</ul>
<p>Similar to the introductory example, we can use simulations to assess the power.</p>
</div>
<div id="mouse-example" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Mouse example</h2>
<ul>
<li><p>In 2021 Choa et al. published that the cytokine Thymic stromal lymphopoietin (TSLP) induced fat loss through sebum secretion (talg). [<a href="https://www.science.org/doi/full/10.1126/science.abd2893">html</a>] [<a href="https://www.science.org/doi/pdf/10.1126/science.abd2893">PDF</a>]</p></li>
<li><p>Suppose that you would like to set up a similar study to test if cytokine interleukin 25 (IL) also has beneficial effect.</p></li>
<li><p>You plan to setup a study with a control group of high fat diet (HFD) fed mice and a treatment group that recieves the HFD and IL.</p></li>
<li><p>What sample size do you need to pick up the effect of the treatment.</p></li>
</ul>
<div id="how-will-we-analyse-the-data-of-this-experiment" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> How will we analyse the data of this experiment?</h3>
<hr />
<ul>
<li><p><span class="math inline">\(H_0\)</span>: The average weight difference is equal to zero</p></li>
<li><p><span class="math inline">\(H-0\)</span>: The average weight difference is different from zero</p></li>
<li><p>Two sample t-test or a t-test on the slope of a linear model with one dummy variable.</p></li>
</ul>
<p><span class="math display">\[ Y_i = \beta_0 + \beta_1 X_\text{iIL} + \epsilon_i\]</span></p>
<p><span class="math display">\[
\text{with }
X_\text{iIL}=\begin{cases}X_{iIL}=0 &amp; \text{HFD}\\X_{iIL}=1 &amp; \text{HFD + IL}\end{cases}.
\]</span></p>
<ul>
<li><p>Estimated effect size <span class="math display">\[\hat\delta = \bar X_{IL} - \bar X_{c} = \hat \beta_1\]</span></p></li>
<li><p>Test statistic <span class="math display">\[
T = \frac{\bar{X}_{IL}-\bar{X}_{c}}{SD_\text{pooled} \times \sqrt{\frac{1}{n_1} + \frac{1}{n_2}}} = \frac{\hat\beta_1}{\text{SE}_{\hat\beta_1}}
\]</span></p></li>
<li><p><span class="math inline">\(\hat \beta_1\)</span> is an unbiased estimator of the real weight difference (<span class="math inline">\(\delta\)</span>) that would occur in the population of rats fed with HFD and rats fed with HFD + IL.</p></li>
</ul>
</div>
<div id="power" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Power?</h3>
<p><span class="math display">\[
P[p &lt; \alpha \vert \beta_1 \neq 0]
\]</span></p>
<ul>
<li>Hence, the power will depend on the real weight difference between the group means <span class="math inline">\(\beta_1\)</span> in the population.</li>
<li>The variability of the weight measurements</li>
<li>The significance level <span class="math inline">\(\alpha\)</span></li>
<li>Sample size <span class="math inline">\(n_{IL}\)</span> and <span class="math inline">\(n_c\)</span> in both groups</li>
</ul>
<p>We can estimate the power if</p>
<ol style="list-style-type: decimal">
<li>The assumptions of the model are met: weights are normally distributed with same variance</li>
</ol>
<p>and we know</p>
<ol start="2" style="list-style-type: decimal">
<li>the standard deviation of the weight measurements around their average mean for HFD-fed mice</li>
<li>the real effect size in the population</li>
<li><span class="math inline">\(n_1\)</span> and <span class="math inline">\(n_2\)</span></li>
</ol>
</div>
<div id="use-data-from-a-previous-experiment-to-get-insight-in-mice-data" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Use data from a previous experiment to get insight in mice data</h3>
<p>Suppose that we have access to the data of a preliminary experiment (e.g. provided by Karen Svenson via Gary Churchill and Dan Gatti and partially funded by P50 GM070683 on <a href="http://genomicsclass.github.io/book/pages/random_variables.html">PH525x</a>)</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mice <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/genomicsclass/dagdata/master/inst/extdata/femaleMiceWeights.csv&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>mice <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Diet, <span class="at">y =</span> Bodyweight)) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()</span></code></pre></div>
<p><img src="08-experimentalDesignII_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mice <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> Bodyweight)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Diet)</span></code></pre></div>
<p><img src="08-experimentalDesignII_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mice <span class="ot">&lt;-</span> mice <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Diet =</span> <span class="fu">as.factor</span>(Diet))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>miceSum <span class="ot">&lt;-</span> mice <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Diet) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(Bodyweight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(Bodyweight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se =</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(n))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>miceSum</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Diet"],"name":[1],"type":["fct"],"align":["left"]},{"label":["mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[4],"type":["int"],"align":["right"]},{"label":["se"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"chow","2":"23.81333","3":"3.022541","4":"12","5":"0.8725323"},{"1":"hf","2":"26.83417","3":"4.097606","4":"12","5":"1.1828769"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>In the experiment we have data from two diets:</p>
<ul>
<li>regular diet of cerial and grain based diet (Chow)</li>
<li>High Fat (hf)</li>
</ul>
<p>We can use the hf mice as input for our power analysis.</p>
<ul>
<li>The data of the hf mice seem to be normally distributed</li>
<li>The mean weight is 26.8g</li>
<li>The SD of the weight is 4.1g</li>
</ul>
<p>Effect size?</p>
<ul>
<li><p>The alternative hypothesis is complex.</p></li>
<li><p>It includes all possible effects!</p></li>
<li><p>In order to do the power analysis we will have to choose a minimum effect size that we would like to detect.</p></li>
<li><p>Suppose that we would like to detect if the weight of the rats difference <span class="math inline">\(\delta\)</span> of at least 10%.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">round</span>(miceSum<span class="sc">$</span>mean[<span class="dv">2</span>] <span class="sc">*</span> .<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>delta</span></code></pre></div>
<pre><code>## [1] -2.7</code></pre>
<p>Note, that the average weight then would get close to that of the rats in our pilot experiment that were fed on the chow diet.</p>
<p>We can set up a simulation study to assess the power of an experiment with 8 mice in each group:</p>
<div id="one-simulation" class="section level4" number="3.4.3.1">
<h4><span class="header-section-number">3.4.3.1</span> One simulation</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1423</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> n2 <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">round</span>(miceSum<span class="sc">$</span>mean[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="sc">-</span>delta</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">round</span>(miceSum<span class="sc">$</span>sd[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="fu">c</span>(n1, n2))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n1 <span class="sc">+</span> n2, <span class="dv">0</span>, <span class="at">sd =</span> sd)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>bhat <span class="ot">&lt;-</span> fit<span class="sc">$</span>coef</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>stat <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)<span class="sc">$</span>coef[<span class="dv">2</span>, ]</span></code></pre></div>
<pre><code>##   Estimate Std. Error    t value   Pr(&gt;|t|) 
##  2.5972480  1.7919658  1.4493848  0.1692595</code></pre>
<p>For this simulated experiment we would not have been able to pick up the effect of the treatment at the significance level <span class="math inline">\(\alpha\)</span>=0.05 (p = <code>r</code> round(summary(fit)$coef[2,“Pr(&gt;|t|)”],2)`)!</p>
<ul>
<li>We have to repeat the experiment many times to estimate the power.</li>
<li>We will therefore put our simulation in a general function.</li>
</ul>
</div>
<div id="simulation-of-repeated-experiments" class="section level4" number="3.4.3.2">
<h4><span class="header-section-number">3.4.3.2</span> Simulation of repeated experiments</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp)</span></code></pre></div>
<pre><code>## Loading required package: mvtnorm</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## Loading required package: TH.data</code></pre>
<pre><code>## Loading required package: MASS</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre><code>## 
## Attaching package: &#39;TH.data&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:MASS&#39;:
## 
##     geyser</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> n2 <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">round</span>(miceSum<span class="sc">$</span>mean[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="sc">-</span>delta</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">round</span>(miceSum<span class="sc">$</span>sd[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>predictorData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Diet =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;hf&quot;</span>), <span class="fu">c</span>(n1, n2)) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>())</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>simLm <span class="ot">&lt;-</span> <span class="cf">function</span>(form, data, betas, sd, contrasts, <span class="at">simIndex =</span> <span class="cn">NA</span>) {</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  dataSim <span class="ot">&lt;-</span> data</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(form, dataSim)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  dataSim<span class="sc">$</span>ySim <span class="ot">&lt;-</span> X <span class="sc">%*%</span> betas <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(dataSim), <span class="dv">0</span>, sd)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  form <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="fu">paste</span>(<span class="st">&quot;ySim ~&quot;</span>, form[[<span class="dv">2</span>]]))</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  fitSim <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, dataSim)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  mcp <span class="ot">&lt;-</span> <span class="fu">glht</span>(fitSim, <span class="at">linfct =</span> contrasts)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">summary</span>(mcp)<span class="sc">$</span>test[<span class="fu">c</span>(<span class="st">&quot;coefficients&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="st">&quot;tstat&quot;</span>, <span class="st">&quot;pvalues&quot;</span>)] <span class="sc">%&gt;%</span> <span class="fu">unlist</span>())</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">simLm</span>(</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">form =</span> <span class="sc">~</span>Diet,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> predictorData,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">betas =</span> <span class="fu">c</span>(b0, b1),</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> sd,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">contrasts =</span> <span class="st">&quot;Diethf = 0&quot;</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## coefficients.Diethf        sigma.Diethf        tstat.Diethf 
##           1.9444623           2.0931302           0.9289734 
##             pvalues 
##           0.3686439</code></pre>
<p>We now have a generic function that can simulate data from a normal distribution for every design. The function has arguments:</p>
<ul>
<li><code>form</code>: One sided formula including the structure of the predictors in the model</li>
<li><code>data</code>: Data frame with the predictor values for the design</li>
<li><code>betas</code>: A vector with values for all mean model parameters</li>
<li><code>sd</code>: The standard deviation of the error</li>
<li><code>contrasts</code>: a scalar or a vector with the null hypotheses that we would like to assess.</li>
<li><code>simIndex</code>: an arbitrary argument that is not used by the function but that will allow it to be used in an sapply loop that runs from 1 up to the number of simulations.</li>
</ul>
<p>Simulate nSim = 1000 repeated experiments:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1425</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>nSim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>simResults <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>nSim, simLm, <span class="at">form =</span> <span class="sc">~</span>Diet, <span class="at">data =</span> predictorData, <span class="at">betas =</span> <span class="fu">c</span>(b0, b1), <span class="at">sd =</span> sd, <span class="at">contrasts =</span> <span class="st">&quot;Diethf = 0&quot;</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="fu">mean</span>(simResults[, <span class="dv">4</span>] <span class="sc">&lt;</span> alpha)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>power</span></code></pre></div>
<pre><code>## [1] 0.221</code></pre>
<p>We have a power of 22.1% to pick up the treatment effect when using 8 bioreps in each treatment group.</p>
</div>
<div id="power-for-multiple-sample-sizes" class="section level4" number="3.4.3.3">
<h4><span class="header-section-number">3.4.3.3</span> Power for multiple sample sizes</h4>
<p>We can now calculate the power for multiple sample sizes.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>), <span class="at">power =</span> <span class="cn">NA</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(power))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> n2 <span class="ot">&lt;-</span> power<span class="sc">$</span>n[i]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  predictorData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Diet =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;hf&quot;</span>), <span class="fu">c</span>(n1, n2)) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>())</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  simResults <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>nSim, simLm, <span class="at">form =</span> <span class="sc">~</span>Diet, <span class="at">data =</span> predictorData, <span class="at">betas =</span> <span class="fu">c</span>(b0, b1), <span class="at">sd =</span> sd, <span class="at">contrasts =</span> <span class="st">&quot;Diethf = 0&quot;</span>))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  power<span class="sc">$</span>power[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(simResults[, <span class="st">&quot;pvalues&quot;</span>] <span class="sc">&lt;</span> alpha)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>power</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["power"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"3","2":"0.114"},{"1":"5","2":"0.158"},{"1":"10","2":"0.304"},{"1":"25","2":"0.648"},{"1":"50","2":"0.890"},{"1":"75","2":"0.982"},{"1":"100","2":"0.998"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>power <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> power)) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="08-experimentalDesignII_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="assess-power-in-function-of-sample-size-for-different-effect-sizes" class="section level4" number="3.4.3.4">
<h4><span class="header-section-number">3.4.3.4</span> Assess power in function of sample size for different effect sizes</h4>
<p>Note, that - the sign of the delta is arbitrary because we test two-sided. - the intercept is arbitrary because we only asses <span class="math inline">\(\beta_0\)</span> - We therefore typically set <span class="math inline">\(\beta_0 = 0\)</span></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>nSim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>deltas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">round</span>(miceSum<span class="sc">$</span>sd[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>power <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">b1 =</span> <span class="fu">rep</span>(deltas, <span class="at">each =</span> <span class="fu">length</span>(ns)),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">rep</span>(ns, <span class="fu">length</span>(deltas)),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">power =</span> <span class="cn">NA</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(power))</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  b1 <span class="ot">&lt;-</span> power<span class="sc">$</span>b1[i]</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> n2 <span class="ot">&lt;-</span> power<span class="sc">$</span>n[i]</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  predictorData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Diet =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;hf&quot;</span>), <span class="fu">c</span>(n1, n2)) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>())</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  simResults <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>nSim, simLm, <span class="at">form =</span> <span class="sc">~</span>Diet, <span class="at">data =</span> predictorData, <span class="at">betas =</span> <span class="fu">c</span>(b0, b1), <span class="at">sd =</span> sd, <span class="at">contrasts =</span> <span class="st">&quot;Diethf = 0&quot;</span>))</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  power<span class="sc">$</span>power[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(simResults[, <span class="st">&quot;pvalues&quot;</span>] <span class="sc">&lt;</span> alpha)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>power <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> power, <span class="at">col =</span> b1 <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>())) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="08-experimentalDesignII_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Note, that the power curves are still a bit choppy because we selected a limited number of sample sizes and because <code>nSim</code> simulations is not enough to get a good power estimate when the power is low.</p>
</div>
</div>
</div>
</div>
<div id="final-remarks" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Final remarks</h1>
<ul>
<li><p>The code can be easily extended towards other designs by altering</p>
<ul>
<li>predictor data</li>
<li>formula</li>
<li>contrast</li>
</ul></li>
<li><p>The simulations start to take long when you evaluate many scenario’s.</p>
<ul>
<li>More efficient code using matrices</li>
<li>For a two group comparison closed form solutions exist</li>
</ul></li>
</ul>
<div id="more-efficient-code-based-on-matrix-algebra" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> More efficient code based on matrix algebra</h2>
<p>Code runs much faster. We now simulate 20 times more experiments in a much shorter time!</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>simFast <span class="ot">&lt;-</span> <span class="cf">function</span>(form, data, betas, sd, contrasts, <span class="at">alpha =</span> .<span class="dv">05</span>, <span class="at">nSim =</span> <span class="dv">10000</span>) {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  ySim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(data) <span class="sc">*</span> nSim, <span class="at">sd =</span> sd)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(ySim) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">nrow</span>(data), nSim)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  design <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(form, data)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  ySim <span class="ot">&lt;-</span> ySim <span class="sc">+</span> <span class="fu">c</span>(design <span class="sc">%*%</span> betas)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  ySim <span class="ot">&lt;-</span> <span class="fu">t</span>(ySim)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Fitting</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  fitAll <span class="ot">&lt;-</span> limma<span class="sc">::</span><span class="fu">lmFit</span>(ySim, design)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Inference</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  varUnscaled <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(contrasts) <span class="sc">%*%</span> fitAll<span class="sc">$</span>cov.coefficients <span class="sc">%*%</span> contrasts)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  contrasts <span class="ot">&lt;-</span> fitAll<span class="sc">$</span>coefficients <span class="sc">%*%</span> contrasts</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  seContrasts <span class="ot">&lt;-</span> varUnscaled<span class="sc">^</span>.<span class="dv">5</span> <span class="sc">*</span> fitAll<span class="sc">$</span>sigma</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  tstats <span class="ot">&lt;-</span> contrasts <span class="sc">/</span> seContrasts</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  pvals <span class="ot">&lt;-</span> <span class="fu">pt</span>(<span class="fu">abs</span>(tstats), fitAll<span class="sc">$</span>df.residual, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(pvals <span class="sc">&lt;</span> alpha))</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>nSim <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">round</span>(miceSum<span class="sc">$</span>sd[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>deltas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> limma<span class="sc">::</span><span class="fu">makeContrasts</span>(<span class="st">&quot;Diethf&quot;</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;(Intercept)&quot;</span>, <span class="st">&quot;Diethf&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in limma::makeContrasts(&quot;Diethf&quot;, levels = c(&quot;(Intercept)&quot;,
## &quot;Diethf&quot;)): Renaming (Intercept) to Intercept</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>powerFast <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(ns) <span class="sc">*</span> <span class="fu">length</span>(deltas), <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(powerFast) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;power&quot;</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>form <span class="ot">&lt;-</span> <span class="er">~</span>Diet</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> ns)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> n2 <span class="ot">&lt;-</span> n</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Simulation</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  predictorData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Diet =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;hf&quot;</span>), <span class="fu">c</span>(n1, n2)) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>())</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (b1 <span class="cf">in</span> deltas)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    betas <span class="ot">&lt;-</span> <span class="fu">c</span>(b0, b1)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    powerFast[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(b1, n, <span class="fu">simFast</span>(form, predictorData, betas, sd, <span class="at">contrasts =</span> contrast, <span class="at">alpha =</span> alpha, <span class="at">nSim =</span> nSim))</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>powerFast <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> power, <span class="at">col =</span> b1 <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>())) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="08-experimentalDesignII_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="more-efficient-code-based-on-closed-form-solution-that-exists-for-two-group-comparison" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> More efficient code based on closed form solution that exists for two group comparison</h2>
<p>For the two sample t-test a closed form estimate exists for the power. In this context the Cohen’s effect size is typically used:</p>
<p><span class="math inline">\(D = \frac{\delta}{SD}\)</span></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">n =</span> <span class="dv">8</span>, <span class="at">delta =</span> delta, <span class="at">sd =</span> sd, <span class="at">type =</span> <span class="st">&quot;two.sample&quot;</span>)</span></code></pre></div>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 8
##           delta = 2.7
##              sd = 4.1
##       sig.level = 0.05
##           power = 0.2320512
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<p>Note, that this is very similar to the power that we calculated using the simulations!</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">round</span>(miceSum<span class="sc">$</span>sd[<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>deltas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>powerTheo <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">deltas =</span> <span class="fu">rep</span>(deltas, <span class="at">each =</span> <span class="fu">length</span>(ns)),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">rep</span>(ns, <span class="fu">length</span>(deltas)),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">power =</span> <span class="cn">NA</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>powerTheo<span class="sc">$</span>power <span class="ot">&lt;-</span> <span class="fu">apply</span>(powerTheo[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">power.t.test</span>(<span class="at">delta =</span> x[<span class="dv">1</span>], <span class="at">n =</span> x[<span class="dv">2</span>], <span class="at">sd =</span> sd, <span class="at">type =</span> <span class="st">&quot;two.sample&quot;</span>)<span class="sc">$</span>power)</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>powerTheo <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> power, <span class="at">col =</span> deltas <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>())) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="08-experimentalDesignII_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiOC4zIEV4cGVyaW1lbnRhbCBEZXNpZ24gSUk6IFJlcGxpY2F0aW9uIGFuZCBQb3dlciIKYXV0aG9yOiAiTGlldmVuIENsZW1lbnQiCmRhdGU6ICJzdGF0T21pY3MsIEdoZW50IFVuaXZlcnNpdHkgKGh0dHBzOi8vc3RhdG9taWNzLmdpdGh1Yi5pbykiCi0tLQoKCjxhIHJlbD0ibGljZW5zZSIgaHJlZj0iaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMCI+PGltZyBhbHQ9IkNyZWF0aXZlIENvbW1vbnMgTGljZW5zZSIgc3R5bGU9ImJvcmRlci13aWR0aDowIiBzcmM9Imh0dHBzOi8vaS5jcmVhdGl2ZWNvbW1vbnMub3JnL2wvYnktbmMtc2EvNC4wLzg4eDMxLnBuZyIgLz48L2E+CgpgYGB7cn0KbGlicmFyeSh0aWR5dmVyc2UpCmBgYAoKIyBDb25jZXB0cwoKLSBFeHBlcmltZW50YWwgdW5pdHMgcmVwcmVzZW50YXRpdmUgZm9yIHBvcHVsYXRpb246IFJhbmRvbWlzYXRpb24KLSBSZXBsaWNhdGlvbjogdGVjaG5pY2FsIHZzIGJpb2xvZ2ljYWwsIHNhbXBsZSBzaXplIC0gcG93ZXIKLSBTb3VyY2VzIG9mIHZhcmlhdGlvbjogdGVjaG5pY2FsLCBiaW9sb2dpY2FsLCB3aXRoaW4gc3ViamVjdCwgYmV0d2VlbiBzdWJqZWN0CgojIFJlcGxpY2F0aW9uCgpUd28gcGFnZXIgb24gUmVwbGljYXRpb24gaW4gbmF0dXJlIG1ldGhvZHM6IFtbUERGXShodHRwczovL3d3dy5uYXR1cmUuY29tL2FydGljbGVzL25tZXRoLjMwOTEucGRmKV0KIVtdKGh0dHBzOi8vd3d3Lm5hdHVyZS5jb20vYXJ0aWNsZXMvbm1ldGguMzA5MS5wZGYpeyB3aWR0aD0xMDAlIH0KCiMjIEV4YW1wbGUKCkNvbnNpZGVyIGEgc2luZ2xlIGNlbGwgUk5BLXNlcSBleHBlcmltZW50IHdoZXJlIHJlc2VhcmNoZXJzIHdhbnQgdG8gYXNzZXNzIHRoZSBlZmZlY3Qgb2YgZHJ1ZyB0cmVhdG1lbnQgb24gZ2VuZSBleHByZXNzaW9uCgpQb3RlbnRpYWwgcmVzZWFyY2ggcXVlc3Rpb25zCgotIElzIHRoZXJlIGEgZGlmZmVyZW5jZSBpbiBhdmVyYWdlIGdlbmUgZXhwcmVzc2lvbiBiZXR3ZWVuIHRyZWF0ZWQgYW5kIG5vbiB0cmVhdGVkIHNhbXBsZXMKLSBJcyB0aGVyZSBhIGRpZmZlcmVuY2UgaW4gdmFyaWFiaWxpdHkgb2YgZ2VuZSBleHByZXNzaW9uIGJldHdlZW4gdHJlYXRlZCBhbmQgbm9uIHRyZWF0ZWQgc2FtcGxlcwoKIyMgU291cmNlcyBvZiB2YXJpYXRpb24KClRBQkxFIDEgTkFUVVJFIE1FVEhPRFMgfCBWT0wuMTEgTk8uOSB8IFNFUFRFTUJFUiAyMDE0IHwgODc5IC0gODgwCgp8ICAgfCBSZXBsaWNhdGUgdHlwZSB8IFJlcGxpY2F0ZSBjYXRlZ29yeSReXHRleHR7YX0kIHwKfDotLS06fDotLS18Oi0tLTp8CnwgfCBDb2xvbmllcyB8CUIgfAp8IHwgU3RyYWlucyB8CUIgfAp8IEFuaW1hbCBzdHVkeSBzdWJqZWN0cyB8IENvaG91c2VkIGdyb3VwcyB8CUIgfAp8IHwgR2VuZGVyIHwgQiB8CnwgfCBJbmRpdmlkdWFscwl8IEIgfAp8IHwgfCB8CnwgfCBPcmdhbnMgZnJvbSBzYWNyaWZpY2VkIGFuaW1hbHMgfCBCIHwKfCB8IE1ldGhvZHMgZm9yIGRpc3NvY2lhdGluZyBjZWxscyBmcm9tIHRpc3N1ZSB8IFQgfAp8IFNhbXBsZSBwcmVwYXJhdGlvbiB8IERpc3NvY2lhdGlvbiBydW5zIGZyb20gZ2l2ZW4gdGlzc3VlIHNhbXBsZSB8IFQgfAp8IHwgSW5kaXZpZHVhbCBjZWxscyB8IEIgfAp8IHwgfCB8CnwgfCBSTkEtc2VxIGxpYnJhcnkgY29uc3RydWN0aW9uIHwgVCB8CnwgfCBSdW5zIGZyb20gdGhlIGxpYnJhcnkgb2YgYSBnaXZlbiBjZWxsIHwJVCB8CnwgU2VxdWVuY2luZyB8IFJlYWRzIGZyb20gZGlmZmVyZW50IHRyYW5zY3JpcHQgbW9sZWN1bGVzIHwgViReXHRleHR7Yn0kIHwKfCB8IFJlYWRzIHdpdGggdW5pcXVlIG1vbGVjdWxhciBpZGVudGlmaWVyIChVTUkpIGZyb20gYSBnaXZlbiB0cmFuc2NyaXB0IG1vbGVjdWxlIHwJVCB8CgooYSkgUmVwbGljYXRlcyBhcmUgY2F0ZWdvcml6ZWQgYXMgYmlvbG9naWNhbCAoQiksIHRlY2huaWNhbCAoVCkgb3Igb2YgdmFyaWFibGUgdHlwZSAoVikuCihiKSBTZXF1ZW5jZSByZWFkcyBzZXJ2ZSBkaXZlcnNlIHB1cnBvc2VzIGRlcGVuZGluZyBvbiB0aGUgYXBwbGljYXRpb24gYW5kIGhvdyByZWFkcyBhcmUgdXNlZCBpbiBhbmFseXNpcy4KCi0tLQoKIyMgQXQgd2hpY2ggbGV2ZWwgc2hvdWxkIHdlIHJlcGxpY2F0ZT8KCi0gJFx0ZXh0e3Zhcn0oWCk9XHNpZ21hXjJfQStcc2lnbWFeMl9DK1xzaWdtYV4yX009XHNpZ21hXjJfe1RPVH0kCi0gJFx0ZXh0e3Zhcn0oXGJhcntYfSk9XGZyYWN7XHNpZ21hXjJfQX17bl9BfStcZnJhY3tcc2lnbWFeMl9DfXtuX0Egbl9DfSArIFxmcmFje1xzaWdtYV4yX019e25fQSBuX0Mgbl9NfSQKCiFbXShodHRwczovL21lZGlhLnNwcmluZ2VybmF0dXJlLmNvbS9mdWxsL3NwcmluZ2VyLXN0YXRpYy9pbWFnZS9hcnQlM0ExMC4xMDM4JTJGbm1ldGguMzA5MS9NZWRpYU9iamVjdHMvNDE1OTJfMjAxNF9BcnRpY2xlX0JGbm1ldGgzMDkxX0ZpZzFfSFRNTC5qcGcpCkZpZ3VyZSAxIE5BVFVSRSBNRVRIT0RTIHwgVk9MLjExIE5PLjkgfCBTRVBURU1CRVIgMjAxNCB8IDg3OSAtIDg4MAoKKGEpIFRocmVlIGxldmVscyBvZiByZXBsaWNhdGlvbiAodHdvIGJpb2xvZ2ljYWwsIG9uZSB0ZWNobmljYWwpIHdpdGggYW5pbWFsLCBjZWxsIGFuZCBtZWFzdXJlbWVudCByZXBsaWNhdGVzIG5vcm1hbGx5IGRpc3RyaWJ1dGVkIHdpdGggYSBtZWFuIGFjcm9zcyBhbmltYWxzIG9mIDEwIGFuZCByYXRpbyBvZiB2YXJpYW5jZXMgMToyOjAuNS4gU29saWQgZ3JlZW4gKGJpb2xvZ2ljYWwpIGFuZCBibHVlICh0ZWNobmljYWwpIGRvdHMgc2hvdyBob3cgYSBtZWFzdXJlbWVudCBvZiB0aGUgZXhwcmVzc2lvbiAoWCA9IDEyKSBzYW1wbGVzIGZyb20gYWxsIHRocmVlIHNvdXJjZXMgb2YgdmFyaWF0aW9uLiBEaXN0cmlidXRpb24gcy5kLiBpcyBzaG93biBhcyBob3Jpem9udGFsIGxpbmVzLgooYikgRXhwcmVzc2lvbiB2YXJpYW5jZSwgVmFyKFgpLCBhbmQgdmFyaWFuY2Ugb2YgZXhwcmVzc2lvbiBtZWFuLCBWYXIoJFxiYXIgWCQpLCBjb21wdXRlZCBhY3Jvc3MgMTAsMDAwIHNpbXVsYXRpb25zIG9mIG5BbkNuTSA9IDQ4IG1lYXN1cmVtZW50cyBmb3IgdW5pcXVlIGNvbWJpbmF0aW9ucyBvZiB0aGUgbnVtYmVyIG9mIGFuaW1hbHMgKG5BID0gMSB0byA0OCksIGNlbGxzIHBlciBhbmltYWwgKG5DID0gMSB0byA0OCkgYW5kIHRlY2huaWNhbCByZXBsaWNhdGUgbWVhc3VyZW1lbnRzIHBlciBjZWxsIChuTSA9IDEgYW5kIDMpLiBUaGUgcmF0aW8gb2YgVmFyKFgpIGFuZCBWYXIoJFxiYXIgWCQpIGlzIHRoZSBlZmZlY3RpdmUgc2FtcGxlIHNpemUsIG4sIHdoaWNoIGNvcnJlc3BvbmRzIHRvIHRoZSBlcXVpdmFsZW50IG51bWJlciBvZiBzdGF0aXN0aWNhbGx5IGluZGVwZW5kZW50IG1lYXN1cmVtZW50cy4gSG9yaXpvbnRhbCBkYXNoZWQgbGluZXMgY29ycmVzcG9uZCB0byBiaW9sb2dpY2FsIGFuZCB0b3RhbCB2YXJpYXRpb24uIEVycm9yIGJhcnMgb24gVmFyKFgpIHNob3cgcy5kLiBmcm9tIHRoZSAxMCwwMDAgc2ltdWxhdGVkIHNhbXBsZXMgKG5NID0gMSkuCgotLS0KCi0gQ29zdCBiZW5lZml0IHRyYWRlLW9mZjogY29zdCBkaWZmZXJlbmNlIGJldHdlZW4gYmlvbG9naWNhbCBhbmQgdGVjaG5pY2FsIHJlcGxpY2F0ZXMKLSBUeXBpY2FsbHksIGJpb2xvZ2ljYWwgdmFyaWFiaWxpdHkgaXMgc3Vic3RhbnRpYWxseSBsYXJnZXIgdGhhbiB0ZWNobmljYWwgdmFyaWFiaWxpdHkKCiRccmlnaHRhcnJvdyQgY29tbWl0IHJlc291cmNlcyB0byBzYW1wbGluZyBiaW9sb2dpY2FsbHkgcmVsZXZhbnQgdmFyaWFibGVzCgokXHJpZ2h0YXJyb3ckIHVubGVzcyBtZWFzdXJlcyBvZiB0ZWNobmljYWwgdmFyaWFiaWxpdHkgYXJlIG9mIGludGVyZXN0IHRoZW4gaW5jcmVhc2luZyBudW1iZXIgb2YgdGVjaG5pY2FsIG1lYXN1cmVtZW50cyBpcyB2YWx1YWJsZS4KCi0gR29vZCBleHBlcmltZW50YWwgZGVzaWduIHByYWN0aWNlIGluY2x1ZGVzIHBsYW5uaW5nIGZvciByZXBsaWNhdGlvbi4KCiAgMS4gSWRlbnRpZnkgdGhlIHJlc2VhcmNoIHF1ZXN0aW9ucyB0byBiZSBhbnN3ZXJlZCB3aXRoIGV4cGVyaW1lbnRzLgogIDIuIERldGVybWluZSBwcm9wb3J0aW9uIG9mIHZhcmlhYmlsaXR5IGluZHVjZWQgYnkgZWFjaCBzdGVwLgogIDMuIEJlIGF3YXJlIGZvciBwc2V1ZG9yZXBsaWNhdGlvbiBhbmQgYWltIGZvciBzdGF0aXN0aWNhbGx5IGluZGVwZW5kZW50IHJlcGxpY2F0ZXMuCgotLS0KCiMgUG93ZXIsIHNhbXBsZSBzaXplIGFuZCBvdGhlciBkZXNpZ24gYXNwZWN0cwoKUmVhZGluZyBtYXRlcmlhbHM6CltOYXR1cmUgTWV0aG9kcyAoMjAxMyksIDEwKDEyKSwgMTEzOeKAkzExNDBdKGh0dHBzOi8vd3d3Lm5hdHVyZS5jb20vYXJ0aWNsZXMvbm1ldGguMjczOC5wZGYpCgojIyBJbnRlcm1lenpvIGxpbmVhciByZWdyZXNzaW9uIGluIG1hdHJpeCBmb3JtCgotIExpbmVhciByZWdyZXNzaW9uIGlzIGEgdmVyeSBpbXBvcnRhbnQgc3RhdGlzdGljYWwgdG9vbCB0byBzdHVkeSB0aGUgYXNzb2NpYXRpb24gYmV0d2VlbiB2YXJpYWJsZXMgYW5kIHRvIGJ1aWxkIHByZWRpY3Rpb24gbW9kZWxzLgoKIyMjIFNjYWxhciBmb3JtCgotIENvbnNpZGVyIGEgdmVjdG9yIG9mIHByZWRpY3RvcnMgJFxtYXRoYmZ7eH09KHhfMSxcbGRvdHMseF9wKSQgYW5kCi0gYSByZWFsLXZhbHVlZCByZXNwb25zZSAkWSQKLSB0aGVuIHRoZSBsaW5lYXIgcmVncmVzc2lvbiBtb2RlbCBjYW4gYmUgd3JpdHRlbiBhcwpcWwpZPWYoXG1hdGhiZnt4fSkgK1xlcHNpbG9uPVxiZXRhXzArXHN1bVxsaW1pdHNfe2o9MX1ecCB4X2pcYmV0YV9qICsgXGVwc2lsb24KXF0Kd2l0aCBpLmkuZC4gJFxlcHNpbG9uXHNpbSBOKDAsXHNpZ21hXjIpJAoKCgojIyMgVmVjdG9yL01hdHJpeCBmb3JtCgotICRuJCBvYnNlcnZhdGlvbnMgJChcbWF0aGJme3h9XzEseV8xKSBcbGRvdHMgKFxtYXRoYmZ7eH1fbix5X24pJCB3aXRoICRcbWF0aGJme3h9XzFeVD1bMSB4XzEgXGxkb3RzIHhfcF0kCi0gUmVncmVzc2lvbiBpbiBtYXRyaXggbm90YXRpb24KXFtcbWF0aGJme1l9PVxtYXRoYmZ7WFxiZXRhfSArIFxtYXRoYmZ7XGVwc2lsb259XF0Kd2l0aCAkXG1hdGhiZntZfT1cbGVmdFtcYmVnaW57YXJyYXl9e2N9eV8xXFwgXHZkb3RzXFx5X25cZW5ke2FycmF5fVxyaWdodF0kLAokXG1hdGhiZntYfT1cbGVmdFtcYmVnaW57YXJyYXl9e2NjY2N9IDEmeF97MTF9JlxsZG90cyZ4X3sxcH1cXApcdmRvdHMmXHZkb3RzJiZcdmRvdHNcXAoxJnhfe24xfSZcbGRvdHMmeF97bnB9ClxlbmR7YXJyYXl9XHJpZ2h0XSQgb3IgJFxtYXRoYmZ7WH09XGxlZnRbXGJlZ2lue2FycmF5fXtjfSBcbWF0aGJme3h9XzFeVFxcXHZkb3RzXFxcbWF0aGJme3h9X25eVFxlbmR7YXJyYXl9XHJpZ2h0XSQsCiRcYm9sZHN5bWJvbHtcYmV0YX09XGxlZnRbXGJlZ2lue2FycmF5fXtjfVxiZXRhXzBcXCBcdmRvdHNcXCBcYmV0YV9wXGVuZHthcnJheX1ccmlnaHRdJCBhbmQKJFxtYXRoYmZ7XGVwc2lsb259PVxsZWZ0W1xiZWdpbnthcnJheX17Y30gXGVwc2lsb25fMSBcXCBcdmRvdHMgXFwgXGVwc2lsb25fblxlbmR7YXJyYXl9XHJpZ2h0XSQKCi0tLQoKIyMgTGVhc3QgU3F1YXJlcyAoTFMpCgotIE1pbmltaXplIHRoZSByZXNpZHVhbCBzdW0gb2Ygc3F1YXJlcwpcYmVnaW57ZXFuYXJyYXkqfQpSU1MoXGJvbGRzeW1ib2x7XGJldGF9KSY9JlxzdW1cbGltaXRzX3tpPTF9Xm4gZV4yX2lcXAomPSZcc3VtXGxpbWl0c197aT0xfV5uIFxsZWZ0KHlfaS1cYmV0YV8wLVxzdW1cbGltaXRzX3tqPTF9XnAgeF97aWp9XGJldGFfalxyaWdodCleMgpcZW5ke2VxbmFycmF5Kn0KCi0gb3IgaW4gbWF0cml4IG5vdGF0aW9uCgokJApcdGV4dHtSU1N9KFxib2xkc3ltYm9se1xiZXRhfSk9KFxtYXRoYmZ7WX0tXG1hdGhiZntYXGJldGF9KV5UKFxtYXRoYmZ7WX0tXG1hdGhiZntYXGJldGF9KQokJAoKJCRccmlnaHRhcnJvdyBcaGF0e1xib2xkc3ltYm9se1xiZXRhfX09XHRleHR7YXJnbWlufV9cYmV0YSBcdGV4dHsgUlNTfShcYm9sZHN5bWJvbHtcYmV0YX0pJCQKCi0tLQoKIyMjIE1pbmltaXplIFJTUwpcWwpcYmVnaW57YXJyYXl9e2NjY30KXGZyYWN7XHBhcnRpYWwgUlNTfXtccGFydGlhbCBcYm9sZHN5bWJvbHtcYmV0YX19Jj0mXG1hdGhiZnswfVxcXFwKXGZyYWN7KFxtYXRoYmZ7WX0tXG1hdGhiZntYXGJldGF9KV5UKFxtYXRoYmZ7WX0tXG1hdGhiZntYfVxib2xkc3ltYm9se1xiZXRhfSl9e1xwYXJ0aWFsIFxib2xkc3ltYm9se1xiZXRhfX0mPSZcbWF0aGJmezB9XFxcXAotMlxtYXRoYmZ7WH1eVChcbWF0aGJme1l9LVxtYXRoYmZ7WH1cYm9sZHN5bWJvbHtcYmV0YX0pJj0mXG1hdGhiZnswfVxcXFwKXG1hdGhiZntYfV5UXG1hdGhiZntYXGJldGF9Jj0mXG1hdGhiZntYfV5UXG1hdGhiZntZfVxcXFwKXGhhdHtcYm9sZHN5bWJvbHtcYmV0YX19Jj0mKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cbWF0aGJme1h9XlRcbWF0aGJme1l9ClxlbmR7YXJyYXl9ClxdCgotLS0KCiMjIFZhcmlhbmNlIEVzdGltYXRvcj8KXFsKXGJlZ2lue2FycmF5fXtjY2x9ClxoYXR7XGJvbGRzeW1ib2x7XFNpZ21hfX1fe1xoYXR7XGJvbGRzeW1ib2x7XGJldGF9fX0KJj0mXHRleHR7dmFyfVxsZWZ0WyhcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9XG1hdGhiZntYfV5UXG1hdGhiZntZfVxyaWdodF1cXFxcCiY9JihcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9XG1hdGhiZntYfV5UXHRleHR7dmFyfVxsZWZ0W1xtYXRoYmZ7WX1ccmlnaHRdXG1hdGhiZntYfShcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9XFxcXAomPSYoXG1hdGhiZntYfV5UXG1hdGhiZntYfSleey0xfVxtYXRoYmZ7WH1eVChcbWF0aGJme0l9XHNpZ21hXjIpXG1hdGhiZntYfShcbWF0aGJme1h9XlRcbWF0aGJme1h9KV57LTF9ClxcXFwKJj0mKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cbWF0aGJme1h9XlRcbWF0aGJme0l9XHF1YWRcbWF0aGJme1h9KFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cc2lnbWFeMlxcXFwKJVxoYXR7XGJvbGRtYXRoe1xTaWdtYX19X3tcaGF0e1xib2xkc3ltYm9se1xiZXRhfX19Jj0mKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cbWF0aGJme1h9XlQgXHRleHR7dmFyfVxsZWZ0W1xtYXRoYmZ7WX1ccmlnaHRdKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cbWF0aGJme1h9XFwKJj0mKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cbWF0aGJme1h9XlRcbWF0aGJme1h9KFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cc2lnbWFeMlxcXFwKJj0mKFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0pXnstMX1cc2lnbWFeMgpcZW5ke2FycmF5fQpcXQoKVGhlIHVuY2VydGFpbnR5IG9uIHRoZSBtb2RlbCBwYXJhbWV0ZXJzIHRodXMgZGVwZW5kcyBvbiB0aGUgcmVzaWR1YWwgdmFyaWFiaWxpdHkgYW5kIHRoZSBkZXNpZ24hCgotIFRoZSBsYXJnZXIgJFxtYXRoYmZ7WH1eVFxtYXRoYmZ7WH0kIHRoZSBtb3JlIGluZm9ybWF0aW9uIHRoZSBleHBlcmltZW50IGNvbnRhaW5zIG9uIHRoZSBtb2RlbCBwYXJhbWV0ZXJzIGFuZCB0aGUgc21hbGxlciB0aGVpciB2YXJpYW5jZXMgYW5kIHN0YW5kYXJkIGVycm9ycyB3aWxsIGJlIQotIEZhY3RvcmlhbCBkZXNpZ25zPwotIERlc2lnbnMgd2l0aCBjb250aW51b3VzIHByZWRpY3RvcnM/CgotLS0KClRoZSBlZmZlY3Qgc2l6ZSBvZiBpbnRlcmVzdCBpcyB0eXBpY2FsbHkgYSBsaW5lYXIgY29tYmluYXRpb25zIG9mIHRoZSBtb2RlbCBwYXJhbWV0ZXJzLCBpLmUuCiQkCmxfMCBcdGltZXMgXGJldGFfMCArIGxfMSBcdGltZXMgXGJldGFfMSArIC4uLiArIGxfe3AtMX0gXHRpbWVzIFxiZXRhX3twLTF9ID0gXG1hdGhiZntMfV5UXGJvbGRzeW1ib2x7XGJldGF9CiQkCgpUaGUgbnVsbCBoeXBvdGhlc2lzIG9mIG91ciB0ZXN0IHN0YXRpc3RpY3MgaXMgdGhhbiBmb3JtdWxhdGVkIGFzCgoKJCQKSF8wOiBcbWF0aGJme0x9XlRcYm9sZHN5bWJvbHtcYmV0YX0gPSAwCiQkCgp2cyB0aGUgYWx0ZXJuYXRpdmUgaHlwb3RoZXNpcwoKJCQKSF8wOiBcbWF0aGJme0x9XlRcYm9sZHN5bWJvbHtcYmV0YX0gXG5lcSAwCiQkCndoaWNoIGNhbiBiZSBhc3Nlc3NlZCB1c2luZyBhIHQtdGVzdCBzdGF0aXN0aWM6CgokJAp0PVxmcmFje1xtYXRoYmZ7TH1eVFxoYXR7XGJvbGRzeW1ib2x7XGJldGF9fSAtIDB9e1x0ZXh0e3NlfV97XG1hdGhiZntMfV5UXGhhdHtcYm9sZHN5bWJvbHtcYmV0YX19fX0KJCQKd2hpY2ggZm9sbG93cyBhIHQtZGlzdHJpYnV0aW9uIHdpdGggbi1wIGRlZ3JlZXMgb2YgZnJlZWRvbSB1bmRlciB0aGUgbnVsbCBoeXBvdGhlc2lzIHdoZW4gYWxsIGFzc3VtcHRpb25zIGZvciB0aGUgbGluZWFyIG1vZGVsIGFyZSB2YWxpZC4KClNvIHRoZSBwb3dlcgoKJCRQKHAgPCAwLjA1IHwgSF8xKSQkCgp3aWxsIHR5cGljYWxseSBkZXBlbmRzIG9uCgotIHRoZSByZWFsIGVmZmVjdCBzaXplIGluIHRoZSBwb3B1bGF0aW9uICAkXG1hdGhiZntMfV5UXGJvbGRzeW1ib2x7XGJldGF9JC4KLSBOdW1iZXIgb2Ygb2JzZXJ2YXRpb25zOiBTRSBhbmQgZGYgb2YgdC10ZXN0LgotIENob2ljZSBvZiB0aGUgZGVzaWduIHBvaW50cy4KLSBDaG9pY2Ugb2Ygc2lnbmlmaWNhbmNlIGxldmVsLgoKU2ltaWxhciB0byB0aGUgaW50cm9kdWN0b3J5IGV4YW1wbGUsIHdlIGNhbiB1c2Ugc2ltdWxhdGlvbnMgdG8gYXNzZXNzIHRoZSBwb3dlci4KCiMjIE1vdXNlIGV4YW1wbGUKCi0gSW4gMjAyMSBDaG9hIGV0IGFsLiBwdWJsaXNoZWQgdGhhdCB0aGUgY3l0b2tpbmUgVGh5bWljIHN0cm9tYWwgbHltcGhvcG9pZXRpbgooVFNMUCkgaW5kdWNlZCBmYXQgbG9zcyB0aHJvdWdoIHNlYnVtIHNlY3JldGlvbiAodGFsZykuIFtbaHRtbF0oaHR0cHM6Ly93d3cuc2NpZW5jZS5vcmcvZG9pL2Z1bGwvMTAuMTEyNi9zY2llbmNlLmFiZDI4OTMpXSBbW1BERl0oaHR0cHM6Ly93d3cuc2NpZW5jZS5vcmcvZG9pL3BkZi8xMC4xMTI2L3NjaWVuY2UuYWJkMjg5MyldCgotIFN1cHBvc2UgdGhhdCB5b3Ugd291bGQgbGlrZSB0byBzZXQgdXAgYSBzaW1pbGFyIHN0dWR5IHRvIHRlc3QgaWYgY3l0b2tpbmUgaW50ZXJsZXVraW4gMjUgKElMKSBhbHNvIGhhcyBiZW5lZmljaWFsIGVmZmVjdC4KCi0gWW91IHBsYW4gdG8gc2V0dXAgYSBzdHVkeSB3aXRoIGEgY29udHJvbCBncm91cCBvZiBoaWdoIGZhdCBkaWV0IChIRkQpIGZlZCBtaWNlIGFuZCBhIHRyZWF0bWVudCBncm91cCB0aGF0IHJlY2lldmVzIHRoZSBIRkQgYW5kIElMLgoKLSBXaGF0IHNhbXBsZSBzaXplIGRvIHlvdSBuZWVkIHRvIHBpY2sgdXAgdGhlIGVmZmVjdCBvZiB0aGUgdHJlYXRtZW50LgoKCiMjIyBIb3cgd2lsbCB3ZSBhbmFseXNlIHRoZSBkYXRhIG9mIHRoaXMgZXhwZXJpbWVudD8KCgotLS0KCgoKLSAkSF8wJDogVGhlIGF2ZXJhZ2Ugd2VpZ2h0IGRpZmZlcmVuY2UgaXMgZXF1YWwgdG8gemVybwotICRILTAkOiBUaGUgYXZlcmFnZSB3ZWlnaHQgZGlmZmVyZW5jZSBpcyBkaWZmZXJlbnQgZnJvbSB6ZXJvCgotIFR3byBzYW1wbGUgdC10ZXN0IG9yIGEgdC10ZXN0IG9uIHRoZSBzbG9wZSBvZiBhIGxpbmVhciBtb2RlbCB3aXRoIG9uZSBkdW1teSB2YXJpYWJsZS4KCiQkIFlfaSA9IFxiZXRhXzAgKyBcYmV0YV8xIFhfXHRleHR7aUlMfSArIFxlcHNpbG9uX2kkJAoKJCQKXHRleHR7d2l0aCB9ClhfXHRleHR7aUlMfT1cYmVnaW57Y2FzZXN9WF97aUlMfT0wICYgXHRleHR7SEZEfVxcWF97aUlMfT0xICYgXHRleHR7SEZEICsgSUx9XGVuZHtjYXNlc30uCiQkCgotIEVzdGltYXRlZCBlZmZlY3Qgc2l6ZQokJFxoYXRcZGVsdGEgPSBcYmFyIFhfe0lMfSAtIFxiYXIgWF97Y30gPSBcaGF0IFxiZXRhXzEkJAoKLSBUZXN0IHN0YXRpc3RpYwokJApUID0gXGZyYWN7XGJhcntYfV97SUx9LVxiYXJ7WH1fe2N9fXtTRF9cdGV4dHtwb29sZWR9IFx0aW1lcyBcc3FydHtcZnJhY3sxfXtuXzF9ICsgXGZyYWN7MX17bl8yfX19ID0gXGZyYWN7XGhhdFxiZXRhXzF9e1x0ZXh0e1NFfV97XGhhdFxiZXRhXzF9fQokJAotICRcaGF0IFxiZXRhXzEkIGlzIGFuIHVuYmlhc2VkIGVzdGltYXRvciBvZiB0aGUgcmVhbCB3ZWlnaHQgZGlmZmVyZW5jZSAoJFxkZWx0YSQpIHRoYXQgd291bGQgb2NjdXIgaW4gdGhlIHBvcHVsYXRpb24gb2YgcmF0cyBmZWQgd2l0aCBIRkQgYW5kIHJhdHMgZmVkIHdpdGggSEZEICsgSUwuCgojIyMgUG93ZXI/CgokJApQW3AgPCBcYWxwaGEgXHZlcnQgXGJldGFfMSBcbmVxIDBdCiQkCgoKLSBIZW5jZSwgdGhlIHBvd2VyIHdpbGwgZGVwZW5kIG9uIHRoZSByZWFsIHdlaWdodCBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGdyb3VwIG1lYW5zICRcYmV0YV8xJCBpbiB0aGUgcG9wdWxhdGlvbi4KLSBUaGUgdmFyaWFiaWxpdHkgb2YgdGhlIHdlaWdodCBtZWFzdXJlbWVudHMKLSBUaGUgc2lnbmlmaWNhbmNlIGxldmVsICRcYWxwaGEkCi0gU2FtcGxlIHNpemUgJG5fe0lMfSQgYW5kICRuX2MkIGluIGJvdGggZ3JvdXBzCgoKV2UgY2FuIGVzdGltYXRlIHRoZSBwb3dlciBpZgoKMS4gVGhlIGFzc3VtcHRpb25zIG9mIHRoZSBtb2RlbCBhcmUgbWV0OiB3ZWlnaHRzIGFyZSBub3JtYWxseSBkaXN0cmlidXRlZCB3aXRoIHNhbWUgdmFyaWFuY2UKCmFuZCB3ZSBrbm93CgoyLiB0aGUgc3RhbmRhcmQgZGV2aWF0aW9uIG9mIHRoZSB3ZWlnaHQgbWVhc3VyZW1lbnRzIGFyb3VuZCB0aGVpciBhdmVyYWdlIG1lYW4gZm9yIEhGRC1mZWQgbWljZQozLiB0aGUgcmVhbCBlZmZlY3Qgc2l6ZSBpbiB0aGUgcG9wdWxhdGlvbgo0LiAkbl8xJCBhbmQgJG5fMiQKCiMjIyBVc2UgZGF0YSBmcm9tIGEgcHJldmlvdXMgZXhwZXJpbWVudCB0byBnZXQgaW5zaWdodCBpbiBtaWNlIGRhdGEKClN1cHBvc2UgdGhhdCB3ZSBoYXZlIGFjY2VzcyB0byB0aGUgZGF0YSBvZiBhIHByZWxpbWluYXJ5IGV4cGVyaW1lbnQgKGUuZy4gcHJvdmlkZWQgYnkgS2FyZW4gU3ZlbnNvbiB2aWEgR2FyeSBDaHVyY2hpbGwgYW5kIERhbiBHYXR0aSBhbmQgcGFydGlhbGx5IGZ1bmRlZCBieSBQNTAgR00wNzA2ODMgb24gW1BINTI1eF0oaHR0cDovL2dlbm9taWNzY2xhc3MuZ2l0aHViLmlvL2Jvb2svcGFnZXMvcmFuZG9tX3ZhcmlhYmxlcy5odG1sKSkKCmBgYHtyfQptaWNlIDwtIHJlYWQuY3N2KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vZ2Vub21pY3NjbGFzcy9kYWdkYXRhL21hc3Rlci9pbnN0L2V4dGRhdGEvZmVtYWxlTWljZVdlaWdodHMuY3N2IikKCm1pY2UgJT4lCiAgZ2dwbG90KGFlcyh4ID0gRGlldCwgeSA9IEJvZHl3ZWlnaHQpKSArCiAgZ2VvbV9ib3hwbG90KG91dGxpZXIuc2hhcGUgPSBGQUxTRSkgKwogIGdlb21faml0dGVyKCkKCm1pY2UgJT4lCiAgZ2dwbG90KGFlcyhzYW1wbGUgPSBCb2R5d2VpZ2h0KSkgKwogIGdlb21fcXEoKSArCiAgZ2VvbV9xcV9saW5lKCkgKwogIGZhY2V0X3dyYXAofkRpZXQpCmBgYAoKYGBge3J9Cm1pY2UgPC0gbWljZSAlPiUgbXV0YXRlKERpZXQgPSBhcy5mYWN0b3IoRGlldCkpCm1pY2VTdW0gPC0gbWljZSAlPiUKICBncm91cF9ieShEaWV0KSAlPiUKICBzdW1tYXJpemUoCiAgICBtZWFuID0gbWVhbihCb2R5d2VpZ2h0LCBuYS5ybSA9IFRSVUUpLAogICAgc2QgPSBzZChCb2R5d2VpZ2h0LCBuYS5ybSA9IFRSVUUpLAogICAgbiA9IG4oKQogICkgJT4lCiAgbXV0YXRlKHNlID0gc2QgLyBzcXJ0KG4pKQptaWNlU3VtCmBgYApJbiB0aGUgZXhwZXJpbWVudCB3ZSBoYXZlIGRhdGEgZnJvbSB0d28gZGlldHM6CgotIHJlZ3VsYXIgZGlldCBvZiBjZXJpYWwgYW5kIGdyYWluIGJhc2VkIGRpZXQgKENob3cpCi0gSGlnaCBGYXQgKGhmKQoKV2UgY2FuIHVzZSB0aGUgaGYgbWljZSBhcyBpbnB1dCBmb3Igb3VyIHBvd2VyIGFuYWx5c2lzLgoKLSBUaGUgZGF0YSBvZiB0aGUgaGYgbWljZSBzZWVtIHRvIGJlIG5vcm1hbGx5IGRpc3RyaWJ1dGVkCi0gVGhlIG1lYW4gd2VpZ2h0IGlzIGByIG1pY2VTdW0gJT4lIGZpbHRlcihEaWV0ID09ICJoZiIpICU+JSBwdWxsKCJtZWFuIikgJT4lIHJvdW5kKC4sMSlgZwotIFRoZSBTRCBvZiB0aGUgd2VpZ2h0IGlzIGByIG1pY2VTdW0gJT4lIGZpbHRlcihEaWV0ID09ICJoZiIpICU+JSBwdWxsKCJzZCIpICU+JSByb3VuZCguLDEpYGcKCkVmZmVjdCBzaXplPwoKLSBUaGUgYWx0ZXJuYXRpdmUgaHlwb3RoZXNpcyBpcyBjb21wbGV4LgotIEl0IGluY2x1ZGVzIGFsbCBwb3NzaWJsZSBlZmZlY3RzIQotIEluIG9yZGVyIHRvIGRvIHRoZSBwb3dlciBhbmFseXNpcyB3ZSB3aWxsIGhhdmUgdG8gY2hvb3NlIGEgbWluaW11bSBlZmZlY3Qgc2l6ZSB0aGF0IHdlIHdvdWxkIGxpa2UgdG8gZGV0ZWN0LgoKLSBTdXBwb3NlIHRoYXQgd2Ugd291bGQgbGlrZSB0byBkZXRlY3QgaWYgdGhlIHdlaWdodCBvZiB0aGUgcmF0cyBkaWZmZXJlbmNlICRcZGVsdGEkIG9mIGF0IGxlYXN0IDEwJS4KCmBgYHtyfQpkZWx0YSA8LSAtcm91bmQobWljZVN1bSRtZWFuWzJdICogLjEsIDEpCmRlbHRhCmBgYAoKTm90ZSwgdGhhdCB0aGUgYXZlcmFnZSB3ZWlnaHQgdGhlbiB3b3VsZCBnZXQgY2xvc2UgdG8gdGhhdCBvZiB0aGUgcmF0cyBpbiBvdXIgcGlsb3QgZXhwZXJpbWVudCB0aGF0IHdlcmUgZmVkIG9uIHRoZSBjaG93IGRpZXQuCgpXZSBjYW4gc2V0IHVwIGEgc2ltdWxhdGlvbiBzdHVkeSB0byBhc3Nlc3MgdGhlIHBvd2VyIG9mIGFuIGV4cGVyaW1lbnQgd2l0aCA4IG1pY2UgaW4gZWFjaCBncm91cDoKCiMjIyMgT25lIHNpbXVsYXRpb24KCmBgYHtyfQpzZXQuc2VlZCgxNDIzKQpuMSA8LSBuMiA8LSA4CmIwIDwtIHJvdW5kKG1pY2VTdW0kbWVhblsyXSwgMSkKYjEgPC0gLWRlbHRhCnNkIDwtIHJvdW5kKG1pY2VTdW0kc2RbMl0sIDEpCmFscGhhIDwtIDAuMDUKCnggPC0gcmVwKDA6MSwgYyhuMSwgbjIpKQp5IDwtIGIwICsgYjEgKiB4ICsgcm5vcm0objEgKyBuMiwgMCwgc2QgPSBzZCkKZml0IDwtIGxtKHkgfiB4KQpiaGF0IDwtIGZpdCRjb2VmCnN0YXQgPC0gc3VtbWFyeShmaXQpCnN1bW1hcnkoZml0KSRjb2VmWzIsIF0KYGBgCgpGb3IgdGhpcyBzaW11bGF0ZWQgZXhwZXJpbWVudCB3ZSB3b3VsZCBgciBpZmVsc2Uoc3VtbWFyeShmaXQpJGNvZWZbMiwiUHIoPnx0fCkiXSA8IGFscGhhLCIiLCJub3QiKWAgaGF2ZSBiZWVuIGFibGUgdG8gcGljayB1cCB0aGUgZWZmZWN0IG9mIHRoZSB0cmVhdG1lbnQgYXQgdGhlIHNpZ25pZmljYW5jZSBsZXZlbCAkXGFscGhhJD1gciBhbHBoYWAgKHAgPSBgcmAgcm91bmQoc3VtbWFyeShmaXQpJGNvZWZbMiwiUHIoPnx0fCkiXSwyKWApIQoKLSBXZSBoYXZlIHRvIHJlcGVhdCB0aGUgZXhwZXJpbWVudCBtYW55IHRpbWVzIHRvIGVzdGltYXRlIHRoZSBwb3dlci4KLSBXZSB3aWxsIHRoZXJlZm9yZSBwdXQgb3VyIHNpbXVsYXRpb24gaW4gYSBnZW5lcmFsIGZ1bmN0aW9uLgoKIyMjIyBTaW11bGF0aW9uIG9mIHJlcGVhdGVkIGV4cGVyaW1lbnRzCgpgYGB7cn0KbGlicmFyeShtdWx0Y29tcCkKbjEgPC0gbjIgPC0gOAoKYjAgPC0gcm91bmQobWljZVN1bSRtZWFuWzJdLCAxKQpiMSA8LSAtZGVsdGEKCnNkIDwtIHJvdW5kKG1pY2VTdW0kc2RbMl0sIDEpCnByZWRpY3RvckRhdGEgPC0gZGF0YS5mcmFtZShEaWV0ID0gcmVwKGMoImMiLCAiaGYiKSwgYyhuMSwgbjIpKSAlPiUgYXMuZmFjdG9yKCkpCgphbHBoYSA8LSAwLjA1CgpzaW1MbSA8LSBmdW5jdGlvbihmb3JtLCBkYXRhLCBiZXRhcywgc2QsIGNvbnRyYXN0cywgc2ltSW5kZXggPSBOQSkgewogIGRhdGFTaW0gPC0gZGF0YQogIFggPC0gbW9kZWwubWF0cml4KGZvcm0sIGRhdGFTaW0pCiAgZGF0YVNpbSR5U2ltIDwtIFggJSolIGJldGFzICsgcm5vcm0obnJvdyhkYXRhU2ltKSwgMCwgc2QpCiAgZm9ybSA8LSBmb3JtdWxhKHBhc3RlKCJ5U2ltIH4iLCBmb3JtW1syXV0pKQogIGZpdFNpbSA8LSBsbShmb3JtLCBkYXRhU2ltKQogIG1jcCA8LSBnbGh0KGZpdFNpbSwgbGluZmN0ID0gY29udHJhc3RzKQogIHJldHVybihzdW1tYXJ5KG1jcCkkdGVzdFtjKCJjb2VmZmljaWVudHMiLCAic2lnbWEiLCAidHN0YXQiLCAicHZhbHVlcyIpXSAlPiUgdW5saXN0KCkpCn0KCnNpbUxtKAogIGZvcm0gPSB+RGlldCwKICBkYXRhID0gcHJlZGljdG9yRGF0YSwKICBiZXRhcyA9IGMoYjAsIGIxKSwKICBzZCA9IHNkLAogIGNvbnRyYXN0cyA9ICJEaWV0aGYgPSAwIgopCmBgYAoKV2Ugbm93IGhhdmUgYSBnZW5lcmljIGZ1bmN0aW9uIHRoYXQgY2FuIHNpbXVsYXRlIGRhdGEgZnJvbSBhIG5vcm1hbCBkaXN0cmlidXRpb24gZm9yIGV2ZXJ5IGRlc2lnbi4KVGhlIGZ1bmN0aW9uIGhhcyBhcmd1bWVudHM6CgotIGBmb3JtYDogT25lIHNpZGVkIGZvcm11bGEgaW5jbHVkaW5nIHRoZSBzdHJ1Y3R1cmUgb2YgdGhlIHByZWRpY3RvcnMgaW4gdGhlIG1vZGVsCi0gYGRhdGFgOiBEYXRhIGZyYW1lIHdpdGggdGhlIHByZWRpY3RvciB2YWx1ZXMgZm9yIHRoZSBkZXNpZ24KLSBgYmV0YXNgOiBBIHZlY3RvciB3aXRoIHZhbHVlcyBmb3IgYWxsIG1lYW4gbW9kZWwgcGFyYW1ldGVycwotIGBzZGA6IFRoZSBzdGFuZGFyZCBkZXZpYXRpb24gb2YgdGhlIGVycm9yCi0gYGNvbnRyYXN0c2A6IGEgc2NhbGFyIG9yIGEgdmVjdG9yIHdpdGggdGhlIG51bGwgaHlwb3RoZXNlcyB0aGF0IHdlIHdvdWxkIGxpa2UgdG8gYXNzZXNzLgotIGBzaW1JbmRleGA6IGFuIGFyYml0cmFyeSBhcmd1bWVudCB0aGF0IGlzIG5vdCB1c2VkIGJ5IHRoZSAgZnVuY3Rpb24gYnV0IHRoYXQgd2lsbCBhbGxvdyBpdCB0byBiZSB1c2VkIGluIGFuIHNhcHBseSBsb29wIHRoYXQgcnVucyBmcm9tIDEgdXAgdG8gdGhlIG51bWJlciBvZiBzaW11bGF0aW9ucy4KClNpbXVsYXRlIG5TaW0gPSAxMDAwIHJlcGVhdGVkIGV4cGVyaW1lbnRzOgoKYGBge3J9CnNldC5zZWVkKDE0MjUpCm5TaW0gPC0gMTAwMAoKc2ltUmVzdWx0cyA8LSB0KHNhcHBseSgxOm5TaW0sIHNpbUxtLCBmb3JtID0gfkRpZXQsIGRhdGEgPSBwcmVkaWN0b3JEYXRhLCBiZXRhcyA9IGMoYjAsIGIxKSwgc2QgPSBzZCwgY29udHJhc3RzID0gIkRpZXRoZiA9IDAiKSkKcG93ZXIgPC0gbWVhbihzaW1SZXN1bHRzWywgNF0gPCBhbHBoYSkKcG93ZXIKYGBgCgpXZSBoYXZlIGEgcG93ZXIgb2YgYHIgcG93ZXIqMTAwYCUgdG8gcGljayB1cCB0aGUgdHJlYXRtZW50IGVmZmVjdCB3aGVuIHVzaW5nIDggYmlvcmVwcyBpbiBlYWNoIHRyZWF0bWVudCBncm91cC4KCiMjIyMgUG93ZXIgZm9yIG11bHRpcGxlIHNhbXBsZSBzaXplcwoKV2UgY2FuIG5vdyBjYWxjdWxhdGUgdGhlIHBvd2VyIGZvciBtdWx0aXBsZSBzYW1wbGUgc2l6ZXMuCgpgYGB7cn0KcG93ZXIgPC0gZGF0YS5mcmFtZShuID0gYygzLCA1LCAxMCwgMjUsIDUwLCA3NSwgMTAwKSwgcG93ZXIgPSBOQSkKCmZvciAoaSBpbiAxOm5yb3cocG93ZXIpKQp7CiAgbjEgPC0gbjIgPC0gcG93ZXIkbltpXQogIHByZWRpY3RvckRhdGEgPC0gZGF0YS5mcmFtZShEaWV0ID0gcmVwKGMoImMiLCAiaGYiKSwgYyhuMSwgbjIpKSAlPiUgYXMuZmFjdG9yKCkpCiAgc2ltUmVzdWx0cyA8LSB0KHNhcHBseSgxOm5TaW0sIHNpbUxtLCBmb3JtID0gfkRpZXQsIGRhdGEgPSBwcmVkaWN0b3JEYXRhLCBiZXRhcyA9IGMoYjAsIGIxKSwgc2QgPSBzZCwgY29udHJhc3RzID0gIkRpZXRoZiA9IDAiKSkKICBwb3dlciRwb3dlcltpXSA8LSBtZWFuKHNpbVJlc3VsdHNbLCAicHZhbHVlcyJdIDwgYWxwaGEpCn0KcG93ZXIKYGBgCgpgYGB7cn0KcG93ZXIgJT4lCiAgZ2dwbG90KGFlcyh4ID0gbiwgeSA9IHBvd2VyKSkgKwogIGdlb21fbGluZSgpCmBgYAoKIyMjIyBBc3Nlc3MgcG93ZXIgaW4gZnVuY3Rpb24gb2Ygc2FtcGxlIHNpemUgZm9yIGRpZmZlcmVudCBlZmZlY3Qgc2l6ZXMKCk5vdGUsIHRoYXQKLSB0aGUgc2lnbiBvZiB0aGUgZGVsdGEgaXMgYXJiaXRyYXJ5IGJlY2F1c2Ugd2UgdGVzdCB0d28tc2lkZWQuCi0gdGhlIGludGVyY2VwdCBpcyBhcmJpdHJhcnkgYmVjYXVzZSB3ZSBvbmx5IGFzc2VzICRcYmV0YV8wJAotIFdlIHRoZXJlZm9yZSB0eXBpY2FsbHkgc2V0ICRcYmV0YV8wID0gMCQKCmBgYHtyfQpuU2ltIDwtIDEwMDAKYjAgPC0gMApkZWx0YXMgPC0gYygxLCAyLCAzLCA1LCAxMCkKc2QgPC0gcm91bmQobWljZVN1bSRzZFsyXSwgMSkKbnMgPC0gYygzLCA1LCAxMCwgMjAsIDI1LCA1MCwgNzUsIDEwMCkKCnBvd2VyIDwtIGRhdGEuZnJhbWUoCiAgYjEgPSByZXAoZGVsdGFzLCBlYWNoID0gbGVuZ3RoKG5zKSksCiAgbiA9IHJlcChucywgbGVuZ3RoKGRlbHRhcykpLAogIHBvd2VyID0gTkEKKQoKZm9yIChpIGluIDE6bnJvdyhwb3dlcikpCnsKICBiMSA8LSBwb3dlciRiMVtpXQogIG4xIDwtIG4yIDwtIHBvd2VyJG5baV0KICBwcmVkaWN0b3JEYXRhIDwtIGRhdGEuZnJhbWUoRGlldCA9IHJlcChjKCJjIiwgImhmIiksIGMobjEsIG4yKSkgJT4lIGFzLmZhY3RvcigpKQogIHNpbVJlc3VsdHMgPC0gdChzYXBwbHkoMTpuU2ltLCBzaW1MbSwgZm9ybSA9IH5EaWV0LCBkYXRhID0gcHJlZGljdG9yRGF0YSwgYmV0YXMgPSBjKGIwLCBiMSksIHNkID0gc2QsIGNvbnRyYXN0cyA9ICJEaWV0aGYgPSAwIikpCiAgcG93ZXIkcG93ZXJbaV0gPC0gbWVhbihzaW1SZXN1bHRzWywgInB2YWx1ZXMiXSA8IGFscGhhKQp9CmBgYAoKYGBge3J9CnBvd2VyICU+JQogIGdncGxvdChhZXMoeCA9IG4sIHkgPSBwb3dlciwgY29sID0gYjEgJT4lIGFzLmZhY3RvcigpKSkgKwogIGdlb21fbGluZSgpCmBgYAoKTm90ZSwgdGhhdCB0aGUgcG93ZXIgY3VydmVzIGFyZSBzdGlsbCBhIGJpdCBjaG9wcHkgYmVjYXVzZSB3ZSBzZWxlY3RlZCBhIGxpbWl0ZWQgbnVtYmVyIG9mIHNhbXBsZSBzaXplcyBhbmQgYmVjYXVzZSBgblNpbWAgc2ltdWxhdGlvbnMgaXMgbm90IGVub3VnaCB0byBnZXQgYSBnb29kIHBvd2VyIGVzdGltYXRlIHdoZW4gdGhlIHBvd2VyIGlzIGxvdy4KCiMgRmluYWwgcmVtYXJrcwoKLSBUaGUgY29kZSBjYW4gYmUgZWFzaWx5IGV4dGVuZGVkIHRvd2FyZHMgb3RoZXIgZGVzaWducyBieSBhbHRlcmluZwoKICAgIC0gcHJlZGljdG9yIGRhdGEKICAgIC0gZm9ybXVsYQogICAgLSBjb250cmFzdAoKLSBUaGUgc2ltdWxhdGlvbnMgc3RhcnQgdG8gdGFrZSBsb25nIHdoZW4geW91IGV2YWx1YXRlIG1hbnkgc2NlbmFyaW8ncy4KCiAgICAtIE1vcmUgZWZmaWNpZW50IGNvZGUgdXNpbmcgbWF0cmljZXMKICAgIC0gRm9yIGEgdHdvIGdyb3VwIGNvbXBhcmlzb24gY2xvc2VkIGZvcm0gc29sdXRpb25zIGV4aXN0CgoKCgojIyBNb3JlIGVmZmljaWVudCBjb2RlIGJhc2VkIG9uIG1hdHJpeCBhbGdlYnJhCgpDb2RlIHJ1bnMgbXVjaCBmYXN0ZXIuIFdlIG5vdyBzaW11bGF0ZSAyMCB0aW1lcyBtb3JlIGV4cGVyaW1lbnRzIGluIGEgbXVjaCBzaG9ydGVyIHRpbWUhCgpgYGB7cn0Kc2ltRmFzdCA8LSBmdW5jdGlvbihmb3JtLCBkYXRhLCBiZXRhcywgc2QsIGNvbnRyYXN0cywgYWxwaGEgPSAuMDUsIG5TaW0gPSAxMDAwMCkgewogIHlTaW0gPC0gcm5vcm0obnJvdyhkYXRhKSAqIG5TaW0sIHNkID0gc2QpCiAgZGltKHlTaW0pIDwtIGMobnJvdyhkYXRhKSwgblNpbSkKICBkZXNpZ24gPC0gbW9kZWwubWF0cml4KGZvcm0sIGRhdGEpCiAgeVNpbSA8LSB5U2ltICsgYyhkZXNpZ24gJSolIGJldGFzKQogIHlTaW0gPC0gdCh5U2ltKQoKICAjIyMgRml0dGluZwogIGZpdEFsbCA8LSBsaW1tYTo6bG1GaXQoeVNpbSwgZGVzaWduKQoKICAjIyMgSW5mZXJlbmNlCiAgdmFyVW5zY2FsZWQgPC0gYyh0KGNvbnRyYXN0cykgJSolIGZpdEFsbCRjb3YuY29lZmZpY2llbnRzICUqJSBjb250cmFzdHMpCiAgY29udHJhc3RzIDwtIGZpdEFsbCRjb2VmZmljaWVudHMgJSolIGNvbnRyYXN0cwogIHNlQ29udHJhc3RzIDwtIHZhclVuc2NhbGVkXi41ICogZml0QWxsJHNpZ21hCiAgdHN0YXRzIDwtIGNvbnRyYXN0cyAvIHNlQ29udHJhc3RzCiAgcHZhbHMgPC0gcHQoYWJzKHRzdGF0cyksIGZpdEFsbCRkZi5yZXNpZHVhbCwgbG93ZXIudGFpbCA9IEZBTFNFKSAqIDIKICByZXR1cm4obWVhbihwdmFscyA8IGFscGhhKSkKfQpgYGAKCmBgYHtyfQpuU2ltIDwtIDIwMDAwCmIwIDwtIDAKc2QgPC0gcm91bmQobWljZVN1bSRzZFsyXSwgMSkKbnMgPC0gYygzLCA1LCAxMCwgMjAsIDI1LCA1MCwgNzUsIDEwMCkKZGVsdGFzIDwtIGMoMSwgMiwgMywgNSwgMTApCgpjb250cmFzdCA8LSBsaW1tYTo6bWFrZUNvbnRyYXN0cygiRGlldGhmIiwgbGV2ZWxzID0gYygiKEludGVyY2VwdCkiLCAiRGlldGhmIikpCgpwb3dlckZhc3QgPC0gbWF0cml4KE5BLCBucm93ID0gbGVuZ3RoKG5zKSAqIGxlbmd0aChkZWx0YXMpLCBuY29sID0gMykgJT4lIGFzLmRhdGEuZnJhbWUoKQpuYW1lcyhwb3dlckZhc3QpIDwtIGMoImIxIiwgIm4iLCAicG93ZXIiKQpmb3JtIDwtIH5EaWV0CgppIDwtIDAKCmZvciAobiBpbiBucykKewogIG4xIDwtIG4yIDwtIG4KCiAgIyMjIFNpbXVsYXRpb24KICBwcmVkaWN0b3JEYXRhIDwtIGRhdGEuZnJhbWUoRGlldCA9IHJlcChjKCJjIiwgImhmIiksIGMobjEsIG4yKSkgJT4lIGFzLmZhY3RvcigpKQoKICBmb3IgKGIxIGluIGRlbHRhcykKICB7CiAgICBpIDwtIGkgKyAxCiAgICBiZXRhcyA8LSBjKGIwLCBiMSkKICAgIHBvd2VyRmFzdFtpLCBdIDwtIGMoYjEsIG4sIHNpbUZhc3QoZm9ybSwgcHJlZGljdG9yRGF0YSwgYmV0YXMsIHNkLCBjb250cmFzdHMgPSBjb250cmFzdCwgYWxwaGEgPSBhbHBoYSwgblNpbSA9IG5TaW0pKQogIH0KfQpgYGAKCmBgYHtyfQpwb3dlckZhc3QgJT4lCiAgZ2dwbG90KGFlcyh4ID0gbiwgeSA9IHBvd2VyLCBjb2wgPSBiMSAlPiUgYXMuZmFjdG9yKCkpKSArCiAgZ2VvbV9saW5lKCkKYGBgCgojIyBNb3JlIGVmZmljaWVudCBjb2RlIGJhc2VkIG9uIGNsb3NlZCBmb3JtIHNvbHV0aW9uIHRoYXQgZXhpc3RzIGZvciB0d28gZ3JvdXAgY29tcGFyaXNvbgoKRm9yIHRoZSB0d28gc2FtcGxlIHQtdGVzdCBhIGNsb3NlZCBmb3JtIGVzdGltYXRlIGV4aXN0cyBmb3IgdGhlIHBvd2VyLgpJbiB0aGlzIGNvbnRleHQgdGhlIENvaGVuJ3MgZWZmZWN0IHNpemUgaXMgdHlwaWNhbGx5IHVzZWQ6CgokRCA9IFxmcmFje1xkZWx0YX17U0R9JAoKCmBgYHtyfQpwb3dlci50LnRlc3QobiA9IDgsIGRlbHRhID0gZGVsdGEsIHNkID0gc2QsIHR5cGUgPSAidHdvLnNhbXBsZSIpCmBgYAoKTm90ZSwgdGhhdCB0aGlzIGlzIHZlcnkgc2ltaWxhciB0byB0aGUgcG93ZXIgdGhhdCB3ZSBjYWxjdWxhdGVkIHVzaW5nIHRoZSBzaW11bGF0aW9ucyEKCmBgYHtyfQpiMCA8LSAwCnNkIDwtIHJvdW5kKG1pY2VTdW0kc2RbMl0sIDEpCm5zIDwtIGMoMywgNSwgMTAsIDIwLCAyNSwgNTAsIDc1LCAxMDApCmRlbHRhcyA8LSBjKDEsIDIsIDMsIDUsIDEwKQoKCnBvd2VyVGhlbyA8LSBkYXRhLmZyYW1lKAogIGRlbHRhcyA9IHJlcChkZWx0YXMsIGVhY2ggPSBsZW5ndGgobnMpKSwKICBuID0gcmVwKG5zLCBsZW5ndGgoZGVsdGFzKSksCiAgcG93ZXIgPSBOQQopCgpwb3dlclRoZW8kcG93ZXIgPC0gYXBwbHkocG93ZXJUaGVvWywgMToyXSwgMSwgZnVuY3Rpb24oeCkgcG93ZXIudC50ZXN0KGRlbHRhID0geFsxXSwgbiA9IHhbMl0sIHNkID0gc2QsIHR5cGUgPSAidHdvLnNhbXBsZSIpJHBvd2VyKQpgYGAKCgpgYGB7cn0KcG93ZXJUaGVvICU+JQogIGdncGxvdChhZXMoeCA9IG4sIHkgPSBwb3dlciwgY29sID0gZGVsdGFzICU+JSBhcy5mYWN0b3IoKSkpICsKICBnZW9tX2xpbmUoKQpgYGAK</div>
<div class="footer">
    <hr>
    This work is licensed under the <a href= "https://creativecommons.org/licenses/by-nc-sa/4.0">
    CC BY-NC-SA 4.0</a> licence.
</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("08-experimentalDesignII.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
